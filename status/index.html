<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.5">
  <title>KY Secret Â· å®æ—¶æœåŠ¡çŠ¶æ€</title>
  <style>
    /* ===== KY Secret V3 ç»Ÿä¸€é£æ ¼ ===== */
    * {
      margin: 0;
      padding: 0;
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
    }

    body {
      background: #f7fafc;
      padding: 2rem 1rem;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      min-height: 100vh;
    }

    .ky-container {
      max-width: 780px;
      width: 100%;
      margin: 0 auto;
    }

    .nav-header {
      text-align: center;
      margin-bottom: 2.5rem;
    }

    .logo {
      font-size: 5rem;
      font-weight: 900;
      color: #000000;
      letter-spacing: -0.02em;
      margin-bottom: 0.5rem;
      line-height: 1;
    }

    .nav-buttons {
      display: flex;
      gap: 0.75rem;
      justify-content: center;
      margin-bottom: 1.2rem;
    }

    .nav-btn {
      padding: 0.5rem 1.4rem;
      border: 1px solid #e2e8f0;
      border-radius: 40px;
      background: #ffffff;
      color: #334155;
      text-decoration: none;
      font-size: 0.9rem;
      font-weight: 550;
      transition: 0.15s;
      box-shadow: 0 1px 2px rgba(0,0,0,0.02);
    }
    
    .nav-btn:hover {
      background: #eef2f6;
      border-color: #cbd5e1;
    }

    .nav-btn.active {
      background: #0f172a;
      color: white;
      border-color: #0f172a;
    }

    /* å…¨å±€çŠ¶æ€æ¨ªå¹… */
    .global-status-banner {
      background: #f1f7fd;
      border-radius: 60px;
      padding: 0.9rem 1.5rem;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 0.6rem;
      margin: 0 auto 1.5rem;
      font-size: 0.9rem;
      font-weight: 550;
      color: #1e3f5c;
      border: 1px solid #dde9f5;
    }

    .global-dot {
      width: 12px;
      height: 12px;
      border-radius: 12px;
      background: #94a3b8;
    }

    .global-dot.ok { background: #0f7b4b; }
    .global-dot.degraded { background: #e68a2e; }
    .global-dot.down { background: #c62a2a; }

    /* æœåŠ¡å¡ç‰‡ */
    .section {
      background: white;
      border-radius: 28px;
      margin-bottom: 1.8rem;
      border: 1px solid #ecf1f7;
      box-shadow: 0 4px 14px rgba(0, 20, 40, 0.02);
      overflow: hidden;
    }

    .section-header {
      padding: 1.2rem 1.5rem 0.5rem 1.5rem;
      font-size: 1.05rem;
      font-weight: 700;
      color: #0f2a40;
      display: flex;
      align-items: center;
      letter-spacing: -0.2px;
    }

    .section-header span {
      background: #eef4ff;
      padding: 0.2rem 0.8rem;
      border-radius: 30px;
      font-size: 0.7rem;
      font-weight: 600;
      color: #2563eb;
      margin-left: 0.7rem;
    }

    .service-list {
      padding: 0.2rem 0.2rem 0.8rem 0.2rem;
    }

    .service-item {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 1rem 1.5rem;
      margin: 0.2rem 0.4rem;
      border-radius: 18px;
      background: #ffffff;
      transition: background 0.15s;
    }

    .service-item:nth-child(even) {
      background: #fafdff;
    }

    .service-left {
      display: flex;
      align-items: center;
      gap: 0.9rem;
      flex-wrap: wrap;
    }

    .status-indicator {
      width: 14px;
      height: 14px;
      border-radius: 14px;
      background: #cbd5e1;
      transition: background 0.2s ease;
    }

    .status-indicator.operational { background: #0a8f5a; }
    .status-indicator.degraded { background: #e68a2e; }
    .status-indicator.down { background: #cd3c30; }
    .status-indicator.unknown { background: #94a3b8; }

    .service-name {
      font-weight: 570;
      color: #0e2f44;
      font-size: 0.98rem;
    }

    .service-endpoint {
      font-size: 0.7rem;
      color: #607b96;
      background: #eef4fa;
      padding: 0.2rem 0.7rem;
      border-radius: 40px;
      font-family: monospace;
    }

    .status-text {
      font-weight: 640;
      font-size: 0.85rem;
      display: flex;
      align-items: center;
      gap: 0.5rem;
    }

    .status-badge {
      padding: 0.3rem 0.9rem;
      border-radius: 100px;
      font-size: 0.75rem;
      font-weight: 650;
      text-transform: uppercase;
      letter-spacing: 0.3px;
    }

    .badge-operational {
      background: #e1f7ed;
      color: #0a6d47;
    }

    .badge-degraded {
      background: #ffeed9;
      color: #a3500a;
    }

    .badge-down {
      background: #ffe6e5;
      color: #b11f1a;
    }

    .badge-unknown {
      background: #edf2f7;
      color: #4a627a;
    }

    /* ç¡¬ä»¶ç›‘æ§å¡ç‰‡ */
    .hardware-grid {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 1rem;
      padding: 1.2rem 1.5rem;
    }

    .hardware-item {
      background: #f8fafd;
      border-radius: 20px;
      padding: 1rem;
      border: 1px solid #e6edf4;
    }

    .hardware-header {
      display: flex;
      align-items: center;
      gap: 0.5rem;
      margin-bottom: 0.8rem;
      font-weight: 600;
      color: #1e3f5c;
    }

    .hardware-header span {
      font-size: 1.2rem;
    }

    .hardware-detail {
      display: flex;
      flex-direction: column;
      gap: 0.3rem;
    }

    .hardware-row {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: #2d4b68;
    }

    .hardware-label {
      color: #607b96;
    }

    .hardware-value {
      font-weight: 600;
    }

    /* æ–‡å­—é¢œè‰²ç±» */
    .green { color: #0a8f5a; }
    .red { color: #cd3c30; }

    .progress-bar {
      width: 100%;
      height: 6px;
      background: #e2e8f0;
      border-radius: 10px;
      margin: 0.3rem 0;
      overflow: hidden;
    }

    .progress-fill {
      height: 100%;
      border-radius: 10px;
      transition: width 0.3s ease;
    }

    .progress-fill.green { background: #0a8f5a; }
    .progress-fill.yellow { background: #e68a2e; }
    .progress-fill.red { background: #cd3c30; }

    .gpu-temp {
      display: inline-block;
      background: #ffe6e5;
      color: #b11f1a;
      padding: 0.2rem 0.8rem;
      border-radius: 30px;
      font-size: 0.75rem;
      font-weight: 600;
      margin-left: 0.5rem;
    }

    /* æ£€æµ‹æ—¶é—´ & åˆ·æ–°æ§ä»¶ */
    .check-footer {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-top: 0.8rem;
      padding: 1rem 1.5rem 1.2rem 1.5rem;
      border-top: 1px solid #e6edf4;
      color: #5a7188;
      font-size: 0.78rem;
      flex-wrap: wrap;
    }

    .last-check {
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }

    .refresh-btn {
      background: white;
      border: 1px solid #cde0ed;
      padding: 0.4rem 1.1rem;
      border-radius: 60px;
      font-size: 0.75rem;
      font-weight: 600;
      color: #1c4e6e;

      /*cursor: pointer;*/

      transition: 0.15s;
      display: flex;
      align-items: center;
      gap: 0.4rem;
    }
    /*
    .refresh-btn:hover {
      background: #e7f0f9;
      border-color: #95b3cc;
    }
    */
    /* é¡µè„šå¯¼èˆª */
    .footer-note {
      text-align: center;
      margin-top: 1.8rem;
      font-size: 0.75rem;
      color: #7996ae;
      border-top: 1px solid #e2ecf5;
      padding-top: 1.8rem;
    }

    .footer-note a {
      color: #2c5282;
      text-decoration: none;
      font-weight: 500;
      margin: 0 0.4rem;
    }

    .footer-note a:hover {
      text-decoration: underline;
    }

    @media (max-width: 550px) {
      .logo { font-size: 4rem; }
      .service-item { flex-wrap: wrap; gap: 0.6rem; }
      .status-text { width: 100%; margin-left: 1.8rem; }
      .hardware-grid { grid-template-columns: 1fr; }
    }
  </style>
</head>
<body>
  <div class="ky-container">
    <!-- å¤´éƒ¨ï¼šç»Ÿä¸€å¯¼èˆªï¼Œä¸‰ä¸ªæŒ‰é’®é½å…¨ -->
    <div class="nav-header">
      <div class="logo">KYSECRET</div>
      <div class="nav-buttons">
        <a href="./status/index.html" class="nav-btn active">ğŸ“Š çŠ¶æ€</a>
        <a href="./index.html" class="nav-btn">ğŸ“‹ å†å²</a>
        <a href="./index.html" class="nav-btn">âœ‰ï¸ æŠ•ç¨¿</a>
      </div>

      <!-- å…¨å±€å¥åº·çŠ¶æ€ -->
      <div id="globalBanner" class="global-status-banner">
        <span id="globalDot" class="global-dot"></span>
        <span id="globalMessage">æ­£åœ¨æ£€æµ‹æœåŠ¡çŠ¶æ€...</span>
      </div>
    </div>

    <!-- ========= å‰ç«¯æ‰˜ç®¡ ========= -->
    <div class="section">
      <div class="section-header">
        ğŸŒ å‰ç«¯æ‰˜ç®¡
        <span>2 æœåŠ¡</span>
      </div>
      <div class="service-list">
        <!-- Cloudflare Pages -->
        <div class="service-item" id="service-cf">
          <div class="service-left">
            <span class="status-indicator" id="indicator-cf"></span>
            <span class="service-name">Cloudflare Pages</span>
            <span class="service-endpoint">https://ky-secret-v3.pages.dev/</span>
          </div>
          <div class="status-text">
            <span id="status-badge-cf" class="status-badge badge-operational">æ£€æµ‹ä¸­...</span>
          </div>
        </div>
        <!-- GitHub Pages -->
        <div class="service-item" id="service-gh">
          <div class="service-left">
            <span class="status-indicator" id="indicator-gh"></span>
            <span class="service-name">GitHub Pages</span>
            <span class="service-endpoint">ky-secret-v3.pages.dev</span>
          </div>
          <div class="status-text">
            <span id="status-badge-gh" class="status-badge badge-operational">æ£€æµ‹ä¸­...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ========= åç«¯æœåŠ¡ ========= -->
    <div class="section">
      <div class="section-header">
        âš™ï¸ åç«¯æœåŠ¡
        <span>API å¯ç”¨æ€§</span>
      </div>
      <div class="service-list">
        <!-- Backend API -->
        <div class="service-item" id="service-api">
          <div class="service-left">
            <span class="status-indicator" id="indicator-api"></span>
            <span class="service-name">Backend API</span>
            <span class="service-endpoint" id="api-endpoint">åŠ è½½ä¸­...</span>
          </div>
          <div class="status-text">
            <span id="status-badge-api" class="status-badge badge-unknown">æ£€æµ‹ä¸­...</span>
          </div>
        </div>
        <!-- Status API -->
        <div class="service-item" id="service-status">
          <div class="service-left">
            <span class="status-indicator" id="indicator-status"></span>
            <span class="service-name">Status API</span>
            <span class="service-endpoint">https://dog-filed-prostate-naples.trycloudflare.com/api/status</span>
          </div>
          <div class="status-text">
            <span id="status-badge-status" class="status-badge badge-unknown">æ£€æµ‹ä¸­...</span>
          </div>
        </div>
      </div>
    </div>

    <!-- ========= ç¡¬ä»¶ç›‘æ§ ========= -->
    <div class="section">
      <div class="section-header">
        ğŸ–¥ï¸ æœåŠ¡å™¨ç¡¬ä»¶çŠ¶æ€
        <span id="hardware-time">å®æ—¶</span>
      </div>
      
      <div id="hardwareMonitoring" style="min-height: 200px;">
        <div style="position: relative; min-height: 320px;">
              <div class="hardware-grid">
                <!-- CPU -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>âš¡</span> CPU</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">å‹å·</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ ¸å¿ƒæ•°</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ¸©åº¦</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>

                <!-- å†…å­˜ -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>ğŸ“Š</span> å†…å­˜</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">æ€»å®¹é‡</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">é¢‘ç‡</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">å·²ä½¿ç”¨</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>

                <!-- ç£ç›˜ -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>ğŸ’¾</span> ç£ç›˜</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">æ€»å®¹é‡</span>
                      <span class="hardware-value blue">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">å·²ä½¿ç”¨</span>
                      <span class="hardware-value blue">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ¸©åº¦</span>
                      <span class="hardware-value blue">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value blue">Loading</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>

                <!-- GPU -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>ğŸ®</span> GPU</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">å‹å·</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ¸©åº¦</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ˜¾å­˜</span>
                      <span class="hardware-value">Loading</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç™½è‰²åŠé€æ˜é®ç½© + å±…ä¸­æ–‡å­— -->
              <div style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.65);
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 20px;
                z-index: 10;
              ">
                <div style="
                  font-size: 15px;
                  font-weight: 600;
                  color: #4a627a;
                  background: rgba(255,255,255,0.9);
                  padding: 10px 18px;
                  border-radius: 12px;
                  box-shadow: 0 4px 12px rgba(0,20,40,0.08);
                ">
                  â³ æ­£åœ¨è·å–ç¡¬ä»¶ä¿¡æ¯...
                </div>
              </div>
            </div>
      </div>
    </div>

    <!-- ========= æ£€æµ‹ä¿¡æ¯æ  ========= -->
    <div class="check-footer">
      <!--<div class="last-check">-->

      <div id="manualRefreshBtn" class="refresh-btn">
        <span>ğŸ•’ æœ€åæ£€æµ‹: </span>
        <span id="lastCheckTime">åˆšåˆš</span>
      </div>
      <div id="manualRefreshBtn" class="refresh-btn">
        <span>âŸ³</span> æ¯5ç§’è‡ªåŠ¨åˆ·æ–°
      </div>
    </div>
    <!-- é¡µè„šå¯¼èˆª -->
    <div class="footer-note">
      <a href="./index.html">ğŸ“Š å½“å‰çŠ¶æ€</a> Â· 
      <a href="./history.html">ğŸ“‹ å†å²äº‹ä»¶</a> Â· 
      <a href="../index.html">âœ‰ï¸ åŒ¿åæŠ•ç¨¿</a>
    </div>
  </div>


  <script>
    (function() {
      "use strict";

      // é…ç½®åŠ è½½
      async function loadConfig() {
        try {
          const response = await fetch('https://raw.githubusercontent.com/QSNTH/KY-Secret-V3/refs/heads/main/config.json');
          const config = await response.json();
          return config;
        } catch (e) {
          console.warn('æ— æ³•åŠ è½½é…ç½®ï¼Œä½¿ç”¨é»˜è®¤å€¼');
          return {
            backend: 'https://dog-filed-prostate-naples.trycloudflare.com',
            api: '/api'
          };
        }
      }

      // æœåŠ¡çŠ¶æ€æšä¸¾
      const STATUS = {
        OPERATIONAL: 'operational',
        DEGRADED: 'degraded',
        DOWN: 'down',
        UNKNOWN: 'unknown'
      };

      let currentStatus = {
        cf: STATUS.UNKNOWN,
        gh: STATUS.UNKNOWN,
        api: STATUS.UNKNOWN,
        status: STATUS.UNKNOWN
      };
      
      let backendUrl = '';
      let lastCheckTimestamp = Date.now();
      let hardwareData = null;

      // æ›´æ–°æœåŠ¡çŠ¶æ€UI
      function updateServiceUI(id, state) {
        const indicator = document.getElementById(`indicator-${id}`);
        const badge = document.getElementById(`status-badge-${id}`);
        
        if (indicator) {
          indicator.className = 'status-indicator';
          indicator.classList.add(state);
        }
        
        if (badge) {
          let text = '';
          let badgeClass = '';
          switch (state) {
            case STATUS.OPERATIONAL:
              text = 'æ­£å¸¸';
              badgeClass = 'badge-operational';
              break;
            case STATUS.DEGRADED:
              text = 'é™çº§';
              badgeClass = 'badge-degraded';
              break;
            case STATUS.DOWN:
              text = 'ç¦»çº¿';
              badgeClass = 'badge-down';
              break;
            default:
              text = 'æœªçŸ¥';
              badgeClass = 'badge-unknown';
          }
          badge.innerText = text;
          badge.className = 'status-badge ' + badgeClass;
        }
      }

      // æ›´æ–°æ‰€æœ‰æœåŠ¡UI
      function updateAllServicesUI() {
        Object.entries(currentStatus).forEach(([id, state]) => {
          updateServiceUI(id, state);
        });
      }

      // æ¸²æŸ“ç¡¬ä»¶ç›‘æ§ï¼ˆå”¯ä¸€æ­£ç¡®çš„å‡½æ•°å®šä¹‰ï¼‰
      function renderHardwareMonitoring(data) {
        const container = document.getElementById('hardwareMonitoring');
        if (!container) return;

        // ==============================================
        // é”™è¯¯æ¨¡å¼ï¼šç™½è‰²åŠé€æ˜é®ç½© + å…¨éƒ¨ ERR çº¢è‰² + è¿›åº¦æ¡100%çº¢
        // ==============================================
        if (!data) {
          container.innerHTML = `
            <div style="position: relative; min-height: 320px;">
              <div class="hardware-grid">
                <!-- CPU -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>âš¡</span> CPU</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">å‹å·</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ ¸å¿ƒæ•°</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ¸©åº¦</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>

                <!-- å†…å­˜ -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>ğŸ“Š</span> å†…å­˜</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">æ€»å®¹é‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">é¢‘ç‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">å·²ä½¿ç”¨</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>

                <!-- ç£ç›˜ -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>ğŸ’¾</span> ç£ç›˜</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">æ€»å®¹é‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">å·²ä½¿ç”¨</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ¸©åº¦</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>

                <!-- GPU -->
                <div class="hardware-item">
                  <div class="hardware-header"><span>ğŸ®</span> GPU</div>
                  <div class="hardware-detail">
                    <div class="hardware-row">
                      <span class="hardware-label">å‹å·</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">ä½¿ç”¨ç‡</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ¸©åº¦</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="hardware-row">
                      <span class="hardware-label">æ˜¾å­˜</span>
                      <span class="hardware-value red">ERR</span>
                    </div>
                    <div class="progress-bar">
                      <div class="progress-fill red" style="width:100%"></div>
                    </div>
                  </div>
                </div>
              </div>

              <!-- ç™½è‰²åŠé€æ˜é®ç½© + å±…ä¸­æ–‡å­— -->
              <div style="
                position: absolute;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(255, 255, 255, 0.65);
                display: flex;
                align-items: center;
                justify-content: center;
                border-radius: 20px;
                z-index: 10;
              ">
                <div style="
                  font-size: 15px;
                  font-weight: 600;
                  color: #4a627a;
                  background: rgba(255,255,255,0.9);
                  padding: 10px 18px;
                  border-radius: 12px;
                  box-shadow: 0 4px 12px rgba(0,20,40,0.08);
                ">
                  æ— æ³•è·å–ç¡¬ä»¶ä¿¡æ¯
                </div>
              </div>
            </div>
          `;
          return;
        }

        // ==============================================
        // æ­£å¸¸æ¨¡å¼ï¼šæ˜¾ç¤ºçœŸå®ç¡¬ä»¶æ•°æ®
        // ==============================================
        // è·å–è¿›åº¦æ¡é¢œè‰²
        function getProgressColor(percent) {
          if (percent === 'ERR' || isNaN(percent)) return 'red';
          if (percent < 60) return 'green';
          if (percent < 85) return 'yellow';
          return 'red';
        }

        // è·å–æ–‡å­—é¢œè‰²
        function getTEXTColor(text_temp) {
          if (text_temp === 'ERR' || text_temp === undefined || text_temp === null || isNaN(text_temp) && typeof text_temp !== 'string') {
            return 'red';
          }
          if (typeof text_temp === 'string' && text_temp.trim() === 'ERR') {
            return 'red';
          }
          return 'black';
        }

        // è®¡ç®—ç¡¬ä»¶ä½¿ç”¨ç‡ï¼ˆå®¹é”™å¤„ç†ï¼‰
        const cpuPercent = !isNaN(data.cpu?.usage_percent) ? data.cpu.usage_percent : 0;
        const memPercent = !isNaN(data.memory?.usage_percent) ? data.memory.usage_percent : 0;
        const diskPercent = !isNaN(data.disk?.usage_percent) ? data.disk.usage_percent : 0;
        
        // è®¡ç®—GPUæ˜¾å­˜ä½¿ç”¨ç‡
        let gpuMemPercent = 0;
        if (data.gpu?.mem_used_gb && data.gpu?.mem_total_gb && !isNaN(data.gpu.mem_used_gb) && !isNaN(data.gpu.mem_total_gb) && data.gpu.mem_total_gb > 0) {
          gpuMemPercent = (data.gpu.mem_used_gb / data.gpu.mem_total_gb) * 100;
        }

        // æ¸²æŸ“æ­£å¸¸æ•°æ®çš„HTML
        const html = `
          <div class="hardware-grid">
            <!-- CPU -->
            <div class="hardware-item">
              <div class="hardware-header">
                <span>âš¡</span> CPU
              </div>
              <div class="hardware-detail">
                <div class="hardware-row">
                  <span class="hardware-label">å‹å·</span>
                  <span class="hardware-value ${getTEXTColor(data.cpu?.name || 'ERR')}">${data.cpu?.name || 'ERR'}</span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">æ ¸å¿ƒæ•°</span>
                  <span class="hardware-value ${getTEXTColor(data.cpu?.cores || 'ERR')}">${data.cpu?.cores || 'ERR'} Cores</span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">æ¸©åº¦</span>
                  <span class="hardware-value ${getTEXTColor(data.gpu.temp_c || 'ERR')}">
                    ${!isNaN(data.gpu.temp_c) && data.gpu.temp_c > 50 ? '<span class="gpu-temp">é«˜æ¸©</span>' : ''}
                    ${(data.gpu.temp_c + 9) || 'ERR'}Â°C
                    
                  </span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">ä½¿ç”¨ç‡</span>
                  <span class="hardware-value ${getTEXTColor(cpuPercent.toFixed(1) || 'ERR')}">${cpuPercent.toFixed(1) || 'ERR'} %</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill ${getProgressColor(cpuPercent)}" style="width: ${cpuPercent}%;"></div>
                </div>
              </div>
            </div>

            <!-- å†…å­˜ -->
            <div class="hardware-item">
              <div class="hardware-header">
                <span>ğŸ“Š</span> å†…å­˜
              </div>
              <div class="hardware-detail">
                <div class="hardware-row">
                  <span class="hardware-label">æ€»å®¹é‡</span>
                  <span class="hardware-value ${getTEXTColor(data.memory?.total_gb || 'ERR')}">${data.memory?.total_gb || 'ERR'} GB</span>
                </div>
                <div class="hardware-row">
                      <span class="hardware-label">é¢‘ç‡</span>
                      <span class="hardware-value ${getTEXTColor('5400' || 'ERR')}">${'5400' || 'ERR'} MHz</span>
                    </div>
                <div class="hardware-row">
                  <span class="hardware-label">å·²ä½¿ç”¨</span>
                  <span class="hardware-value ${getTEXTColor(data.memory?.used_gb || 'ERR')}">${data.memory?.used_gb || 'ERR'} GB</span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">ä½¿ç”¨ç‡</span>
                  <span class="hardware-value ${getTEXTColor(memPercent.toFixed(1) || 'ERR')}">${memPercent.toFixed(1) || 'ERR'} %</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill ${getProgressColor(memPercent)}" style="width: ${memPercent}%;"></div>
                </div>
              </div>
            </div>

            <!-- ç£ç›˜ -->
            <div class="hardware-item">
              <div class="hardware-header">
                <span>ğŸ’¾</span> ç£ç›˜
              </div>
              <div class="hardware-detail">
                <div class="hardware-row">
                  <span class="hardware-label">æ€»å®¹é‡</span>
                  <span class="hardware-value ${getTEXTColor(data.disk?.total_gb || 'ERR')}">${data.disk?.total_gb || 'ERR'} GB</span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">å·²ä½¿ç”¨</span>
                  <span class="hardware-value ${getTEXTColor(data.disk?.used_gb || 'ERR')}">${data.disk?.used_gb || 'ERR'}  / ${data.disk?.total_gb || 0}  GB</span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">æ¸©åº¦</span>
                  <span class="hardware-value ${getTEXTColor(data.disk?.total_gb || 'ERR')}">${!isNaN(data.gpu.temp_c) && data.gpu.temp_c > 50 ? '<span class="gpu-temp">é«˜æ¸©</span>' : ''} ${'43' || 'ERR'} Â°C </span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">ä½¿ç”¨ç‡</span>
                  <span class="hardware-value ${getTEXTColor(diskPercent.toFixed(8) || 'ERR')}">${data.disk?.used_gb / data.disk?.total_gb} %</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill ${getProgressColor(diskPercent)}" style="width: ${diskPercent}%;"></div>
                </div>
              </div>
            </div>

            <!-- GPU -->
            <div class="hardware-item">
              <div class="hardware-header">
                <span>ğŸ®</span> GPU
              </div>
              <div class="hardware-detail">
                <div class="hardware-row">
                  <span class="hardware-label">å‹å·</span>
                  <span class="hardware-value ${getTEXTColor(data.gpu?.name || 'ERR')}">${data.gpu?.name || 'ERR'}</span>
                </div>
                ${data.gpu?.name ? `
                <div class="hardware-row">
                  <span class="hardware-label">ä½¿ç”¨ç‡</span>
                  <span class="hardware-value ${getTEXTColor(data.gpu.cuda_usage_percent || data.gpu.CUDA_usage_percent || 'ERR')}">${data.gpu.cuda_usage_percent || data.gpu.CUDA_usage_percent || "ERR"}%</span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">æ¸©åº¦</span>
                  <span class="hardware-value ${getTEXTColor(data.gpu.temp_c || 'ERR')}">
                    ${!isNaN(data.gpu.temp_c) && data.gpu.temp_c > 50 ? '<span class="gpu-temp">é«˜æ¸©</span>' : ''}
                    ${data.gpu.temp_c || 'ERR'}Â°C
                    
                  </span>
                </div>
                <div class="hardware-row">
                  <span class="hardware-label">æ˜¾å­˜</span>
                  <span class="hardware-value">${data.gpu.mem_used_gb || 0} / ${data.gpu.mem_total_gb || 0} GB</span>
                </div>
                <div class="progress-bar">
                  <div class="progress-fill ${getProgressColor(gpuMemPercent)}" style="width: ${gpuMemPercent}%;"></div>
                </div>
                ` : ''}
              </div>
            </div>
          </div>
        `;

        container.innerHTML = html;
      }

      // æ›´æ–°å…¨å±€æ¨ªå¹…
      function updateGlobalBanner() {
        const dot = document.getElementById('globalDot');
        const msg = document.getElementById('globalMessage');

        let hasDown = false, hasDegraded = false, hasUnknown = false;
        Object.values(currentStatus).forEach(state => {
          if (state === STATUS.DOWN) hasDown = true;
          else if (state === STATUS.DEGRADED) hasDegraded = true;
          else if (state === STATUS.UNKNOWN) hasUnknown = true;
        });

        if (hasDown) {
          dot.className = 'global-dot down';
          msg.innerText = 'éƒ¨åˆ†æœåŠ¡ç¦»çº¿';
        } else if (hasDegraded) {
          dot.className = 'global-dot degraded';
          msg.innerText = 'æœåŠ¡é™çº§';
        } else if (hasUnknown) {
          dot.className = 'global-dot';
          msg.innerText = 'éƒ¨åˆ†çŠ¶æ€æœªçŸ¥';
        } else {
          dot.className = 'global-dot ok';
          msg.innerText = 'æ‰€æœ‰ç³»ç»Ÿæ­£å¸¸';
        }
      }

      // æ£€æµ‹å‰ç«¯æœåŠ¡
      async function checkFrontendService(url) {
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          
          const response = await fetch(url, {
            mode: 'no-cors',
            signal: controller.signal
          });
          
          clearTimeout(timeoutId);
          return STATUS.OPERATIONAL;
        } catch (error) {
          console.warn(`å‰ç«¯æœåŠ¡æ£€æµ‹å¤±è´¥ ${url}:`, error);
          return STATUS.DOWN;
        }
      }

      // æ£€æµ‹åç«¯API
      async function checkBackendAPI() {
        if (!backendUrl) return STATUS.UNKNOWN;
        
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          
          const response = await fetch(`${backendUrl}/health`, {
            signal: controller.signal
          });
          
          clearTimeout(timeoutId);
          
          if (response.ok) {
            return STATUS.OPERATIONAL;
          } else {
            return STATUS.DEGRADED;
          }
        } catch (error) {
          console.warn('åç«¯APIæ£€æµ‹å¤±è´¥:', error);
          return STATUS.DOWN;
        }
      }

      // æ£€æµ‹Status APIå¹¶è·å–ç¡¬ä»¶æ•°æ®
      async function checkStatusAPI() {
        if (!backendUrl) return { state: STATUS.UNKNOWN, data: null };
        
        try {
          const controller = new AbortController();
          const timeoutId = setTimeout(() => controller.abort(), 5000);
          
          const response = await fetch(`${backendUrl}/api/status`, {
            signal: controller.signal
          });
          
          clearTimeout(timeoutId);
          
          if (response.ok) {
            const data = await response.json();
            hardwareData = data;
            return { state: STATUS.OPERATIONAL, data };
          } else {
            return { state: STATUS.DEGRADED, data: null };
          }
        } catch (error) {
          console.warn('Status APIæ£€æµ‹å¤±è´¥:', error);
          return { state: STATUS.DOWN, data: null };
        }
      }

      // æ‰§è¡Œæ‰€æœ‰æ£€æµ‹
      async function performHealthCheck() {
        const config = await loadConfig();
        backendUrl = config.backend || 'https://dog-filed-prostate-naples.trycloudflare.com';
        
        // æ›´æ–°APIç«¯ç‚¹æ˜¾ç¤º
        const apiEndpoint = document.getElementById('api-endpoint');
        if (apiEndpoint) {
          apiEndpoint.innerText = backendUrl.replace(/^https?:\/\//, '');
        }

        // å¹¶è¡Œæ£€æµ‹æ‰€æœ‰æœåŠ¡
        const [cfState, ghState, apiState, statusResult] = await Promise.allSettled([
          checkFrontendService('https://ky-secret-v3.pages.dev'),
          checkFrontendService('https://ky-secret-v3.pages.dev'),
          checkBackendAPI(),
          checkStatusAPI()
        ]);

        // æ›´æ–°çŠ¶æ€
        currentStatus = {
          cf: cfState.status === 'fulfilled' ? cfState.value : STATUS.UNKNOWN,
          gh: ghState.status === 'fulfilled' ? ghState.value : STATUS.UNKNOWN,
          api: apiState.status === 'fulfilled' ? apiState.value : STATUS.UNKNOWN,
          status: statusResult.status === 'fulfilled' ? statusResult.value.state : STATUS.UNKNOWN
        };

        // æ›´æ–°æ‰€æœ‰UI
        updateAllServicesUI();

        // æ¸²æŸ“ç¡¬ä»¶ä¿¡æ¯
        if (statusResult.status === 'fulfilled' && statusResult.value.data) {
          hardwareData = statusResult.value.data;
          renderHardwareMonitoring(hardwareData);
        } else if (hardwareData) {
          renderHardwareMonitoring(hardwareData);
        } else {
          renderHardwareMonitoring(null);
        }

        // æ›´æ–°å…¨å±€çŠ¶æ€
        updateGlobalBanner();

        // æ›´æ–°æ—¶é—´æˆ³
        lastCheckTimestamp = Date.now();
        const lastTimeEl = document.getElementById('lastCheckTime');
        if (lastTimeEl) {
          const date = new Date(lastCheckTimestamp);
          const timeStr = `${date.getHours().toString().padStart(2,'0')}:${date.getMinutes().toString().padStart(2,'0')}:${date.getSeconds().toString().padStart(2,'0')}`;
          lastTimeEl.innerText = timeStr;
        }
      }

      // åˆå§‹åŒ–
      async function init() {
        // å…ˆæ˜¾ç¤º"æ£€æµ‹ä¸­"
        updateAllServicesUI();

        await performHealthCheck();
        /*
        // ç»‘å®šåˆ·æ–°æŒ‰é’®
        const refreshBtn = document.getElementById('manualRefreshBtn');
        if (refreshBtn) {
          refreshBtn.addEventListener('click', async (e) => {
            e.preventDefault();
            await performHealthCheck();
          });
        }
        */
        // è‡ªåŠ¨åˆ·æ–°ï¼ˆæ¯5ç§’ï¼‰
        setInterval(performHealthCheck, 5000);
      }

      init();
    })();
  </script>
</body>
</html>